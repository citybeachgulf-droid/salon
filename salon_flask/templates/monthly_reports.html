<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>التقارير الشهرية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dir-rtl { direction: rtl; }
  </style>
  <script>
    function onMonthChange(e){
      const params = new URLSearchParams(window.location.search);
      params.set('month', e.value);
      window.location.search = params.toString();
    }
  </script>
</head>
<body class="bg-pink-50 font-sans dir-rtl">
  <header class="bg-pink-300 p-4 shadow-md">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-bold text-white">التقارير الشهرية</h1>
      <nav class="flex items-center gap-2">
        <a href="{{ url_for('main.admin_dashboard') }}" class="bg-white text-black py-2 px-4 rounded-lg shadow hover:bg-gray-100 transition">لوحة المدير</a>
      </nav>
    </div>
  </header>

  <main class="p-6 space-y-8">
    <div class="bg-white p-4 rounded-xl shadow-md flex flex-col md:flex-row md:items-center gap-4">
      <label class="text-pink-700 font-semibold">اختر الشهر:</label>
      <input type="month" value="{{ month_str }}" class="border rounded-md p-2" onchange="onMonthChange(this)" />
      <div class="ms-auto text-gray-600">الفترة: {{ period_start }} — {{ period_end }}</div>
    </div>

    <!-- القسم المالي -->
    <section class="grid md:grid-cols-4 gap-6">
      <div class="bg-white p-6 rounded-xl shadow text-center">
        <div class="text-sm text-gray-500">الإيرادات</div>
        <div class="text-2xl font-bold text-green-600">{{ total_revenue }} ر.ع</div>
      </div>
      <div class="bg-white p-6 rounded-xl shadow text-center">
        <div class="text-sm text-gray-500">المصاريف</div>
        <div class="text-2xl font-bold text-red-600">{{ total_expenses }} ر.ع</div>
      </div>
      <div class="bg-white p-6 rounded-xl shadow text-center">
        <div class="text-sm text-gray-500">الرواتب</div>
        <div class="text-2xl font-bold text-red-600">{{ total_salaries }} ر.ع</div>
      </div>
      <div class="bg-white p-6 rounded-xl shadow text-center">
        <div class="text-sm text-gray-500">الربح</div>
        <div class="text-2xl font-bold text-blue-600">{{ total_profit }} ر.ع</div>
      </div>
    </section>

    <section class="bg-white p-6 rounded-xl shadow">
      <h2 class="text-xl font-semibold text-pink-700 mb-4">ملخص العمليات</h2>
      <div class="text-gray-700">عدد الحجوزات المكتملة: <span class="font-bold">{{ completed_bookings_count }}</span></div>
    </section>

    <!-- تقارير الموظفين -->
    <section class="bg-white p-6 rounded-xl shadow">
      <h2 class="text-xl font-semibold text-pink-700 mb-4">تقارير الموظفين</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="bg-pink-100 text-pink-800">
              <th class="p-3 text-right">الموظف</th>
              <th class="p-3 text-right">حجوزات مكتملة</th>
              <th class="p-3 text-right">الدخل الناتج</th>
              <th class="p-3 text-right">عرض التفاصيل</th>
            </tr>
          </thead>
          <tbody>
            {% for emp in employees_stats %}
            <tr class="border-b hover:bg-pink-50">
              <td class="p-3">{{ emp.name }}</td>
              <td class="p-3">{{ emp.bookings_count }}</td>
              <td class="p-3">{{ emp.income_total }} ر.ع</td>
              <td class="p-3">
                <a class="text-blue-600 hover:underline" href="{{ url_for('main.employee_detail', employee_id=emp.id, month=month_str) }}">تفاصيل الشهر</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  </main>
</body>
</html>

